Regarding the application of DMD algorithm for in vivo studies, please notice the following remarks:

- The ventilation and perfusion frequencies are dependent on the subject. For example, pediatric   patients would be expected to have faster heart and respiration rates than adults. Therefore, it is necessary to adjust the search frequency ranges (“ventRange” and “perfRange”) accordingly. 
- A rough estimate for these search ranges can be calculated using a 1D Fourier transform approach. In other words: Calculating mean image amplitude over time, calculating its Fourier transform among time axis, selecting the peaks as ventilation and perfusion frequencies. For this approach, instead of averaging over the whole image, cropping into a region that contains lungs would improve this frequency estimation. Alternatively, frequencies can be selected by looking at the results of the DMD algorithm. The frequencies, mode amplitudes and eigenvalues can be used together to select stable frequencies. 
- In the phantom, background noise levels needed for the fractional ventilation maps are calculated based on a square region selected from the edge of the DC image. However, this can be problematic for in vivo acquisitions based on the selected FOV and filtering operations (e.g., distortion correction). As such, alternative methods might be needed. In our volunteer data, selecting 3rd percentile of the DC image provided good results. (“BG = prctile(dc_DMD(:),3);”)
- The normalized perfusion maps are obtained with respect to large vessels. In the phantom, we used the 99th percentile to automatically select the signal levels in the large vessels. For in vivo acquisitions, there might be artifacts or regions which result in large perfusion values, and this normalization operation might become erroneous. To overcome this, the signal intensity calculation of large vessels could be restricted to a smaller region. 
- Based on the image acquisition rate, the data-stacking number (“stackNum”) may cause temporal blurring. For our acquisitions with 3.2 images/sec we did not observe this, but for slower rates, the data-stacking number might be needed to be adjusted.  

Note: The results in this study were obtained using MATLAB version R2022a. Different results might be observed when using older MATLAB version. This is due to a change in the “mldivide” function. Specifically, starting with R2022a, LDL factorization no longer used for full matrices. Please see MATLAB documentation for more details.  
